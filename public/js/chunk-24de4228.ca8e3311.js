(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-24de4228"],{e395:function(o,e,t){"use strict";var n=function(){var o=this,e=o.$createElement,t=o._self._c||e;return t("el-dialog",{attrs:{title:"请选择商品类目","show-close":!1,visible:o.visible,"close-on-click-modal":!1,width:"30%"},on:{"update:visible":function(e){o.visible=e}}},[t("el-tree",{ref:"tree",attrs:{data:o.data,"show-checkbox":"","node-key":"id","default-checked-keys":o.defaultCheckeds,"highlight-current":"",props:o.goodsCategoryProps}}),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary"},on:{click:o.close}},[o._v("确 定")])],1)],1)},r=[],i=(t("fe59"),t("08ba"),t("c276"),t("09bb"),{props:{data:{type:Array,default:function(){return[]}},defaultCheckeds:{type:Array,default:function(){return[]}},visible:{type:Boolean,default:function(){return!1}}},data:function(){return{goodsCategoryProps:{children:"childCategoryList",label:"categoryName"}}},methods:{close:function(){var o=this.$refs.tree.getCheckedNodes(),e=[];o&&o.length>0?(o.forEach((function(o){o.childCategoryList||e.push({goodsCategoryId:o.id,goodsCategoryName:o.categoryName})})),this.$emit("close",e)):this.$alert("请选择商品类目","提示")}}}),c=i,a=t("9ca4"),s=Object(a["a"])(c,n,r,!1,null,null,null);e["a"]=s.exports},ea69:function(o,e,t){"use strict";var n=t("1c8b"),r=t("e1d6"),i=t("3da3"),c=t("d88d"),a=t("3553"),s=t("1ca1"),l=t("1bbd"),u=t("1ea7"),p=t("ff9c"),m=u("splice"),d=p("splice",{ACCESSORS:!0,0:0,1:2}),f=Math.max,g=Math.min,h=9007199254740991,y="Maximum allowed length exceeded";n({target:"Array",proto:!0,forced:!m||!d},{splice:function(o,e){var t,n,u,p,m,d,v=a(this),F=c(v.length),C=r(o,F),b=arguments.length;if(0===b?t=n=0:1===b?(t=0,n=F-C):(t=b-2,n=g(f(i(e),0),F-C)),F+t-n>h)throw TypeError(y);for(u=s(v,n),p=0;p<n;p++)m=C+p,m in v&&l(u,p,v[m]);if(u.length=n,t<n){for(p=C;p<F-n;p++)m=p+n,d=p+t,m in v?v[d]=v[m]:delete v[d];for(p=F;p>F-n+t;p--)delete v[p-1]}else if(t>n)for(p=F-n;p>C;p--)m=p+n-1,d=p+t-1,m in v?v[d]=v[m]:delete v[d];for(p=0;p<t;p++)v[p+C]=arguments[p+2];return v.length=F-n+t,u}})},ecb4:function(o,e,t){"use strict";var n=t("1c8b"),r=t("45af").indexOf,i=t("d7e1"),c=t("ff9c"),a=[].indexOf,s=!!a&&1/[1].indexOf(1,-0)<0,l=i("indexOf"),u=c("indexOf",{ACCESSORS:!0,1:0});n({target:"Array",proto:!0,forced:s||!l||!u},{indexOf:function(o){return s?a.apply(this,arguments)||0:r(this,o,arguments.length>1?arguments[1]:void 0)}})},fa87:function(o,e,t){"use strict";t.r(e);var n=function(){var o=this,e=o.$createElement,t=o._self._c||e;return t("div",{staticClass:"gooods__edit"},[t("el-card",{attrs:{shadow:"always"}},[t("el-form",{ref:"couponForm",attrs:{model:o.couponForm,"label-width":"120px",rules:o.rules}},[t("h3",[o._v("基本信息")]),t("el-divider"),t("el-form-item",{attrs:{label:"优惠券名称",prop:"couponName"}},[t("el-input",{staticStyle:{width:"400px"},attrs:{placeholder:"优惠券名称",maxlength:"50","show-word-limit":""},model:{value:o.couponForm.couponName,callback:function(e){o.$set(o.couponForm,"couponName",e)},expression:"couponForm.couponName"}})],1),t("el-form-item",{attrs:{label:"优惠券类型"}},[t("el-select",{attrs:{placeholder:"请选择"},model:{value:o.couponForm.couponType,callback:function(e){o.$set(o.couponForm,"couponType",e)},expression:"couponForm.couponType"}},o._l(o.couponTypeOptions,(function(o){return t("el-option",{key:o.value,attrs:{label:o.label,value:o.value}})})),1),o.couponTypeErrorFlag?t("div",{staticClass:"el-form-item__error"},[o._v(o._s(o.couponTypeErrorText))]):o._e()],1),t("el-form-item",[2==o.couponForm.couponType||3==o.couponForm.couponType||4==o.couponForm.couponType?t("span",[3==o.couponForm.couponType?t("span",[o._v("每")]):o._e(),o._v("满 "),t("el-input-number",{staticStyle:{width:"150px"},attrs:{min:.01,max:99999999,precision:2},model:{value:o.couponForm.orderFullAmount,callback:function(e){o.$set(o.couponForm,"orderFullAmount",e)},expression:"couponForm.orderFullAmount"}}),o._v(" 元 ")],1):o._e(),1==o.couponForm.couponType||2==o.couponForm.couponType||3==o.couponForm.couponType?t("span",[o._v(" 优惠 "),t("el-input-number",{staticStyle:{width:"150px"},attrs:{min:.01,max:99999999,precision:2},model:{value:o.couponForm.promotionAmount,callback:function(e){o.$set(o.couponForm,"promotionAmount",e)},expression:"couponForm.promotionAmount"}}),o._v(" 元 ")],1):o._e(),4==o.couponForm.couponType?t("span",[o._v(" 优惠 "),t("el-input-number",{staticStyle:{width:"150px"},attrs:{min:.1,max:9.9,precision:1},model:{value:o.couponForm.discountAmount,callback:function(e){o.$set(o.couponForm,"discountAmount",e)},expression:"couponForm.discountAmount"}}),o._v(" 折 ")],1):o._e(),3==o.couponForm.couponType||4==o.couponForm.couponType?t("span",[o._v(" 封顶优惠 "),t("el-input-number",{staticStyle:{width:"150px"},attrs:{max:99999999,precision:2},model:{value:o.couponForm.promotionMaxAmount,callback:function(e){o.$set(o.couponForm,"promotionMaxAmount",e)},expression:"couponForm.promotionMaxAmount"}}),o._v(" 元 ")],1):o._e(),5==o.couponForm.couponType?t("div",[o._l(o.promotionAmountScope,(function(e,n){return t("div",{key:n,staticClass:"mb10"},[o._v(" 满 "),t("el-input-number",{staticStyle:{width:"150px"},attrs:{min:.01,max:99999999,precision:2},model:{value:e.orderFullAmount,callback:function(t){o.$set(e,"orderFullAmount",t)},expression:"item.orderFullAmount"}}),o._v(" 元 优惠 "),t("el-input-number",{staticStyle:{width:"150px"},attrs:{min:.01,max:99999999,precision:2},model:{value:e.promotionAmount,callback:function(t){o.$set(e,"promotionAmount",t)},expression:"item.promotionAmount"}}),o._v(" 元 "),o.promotionAmountScope.length>2?t("el-button",{staticClass:"ml20",attrs:{type:"danger"},on:{click:function(e){return o.delPromotionAmountScope(n)}}},[o._v("删除阶梯")]):o._e(),t("span",{staticClass:"ml10",staticStyle:{color:"#F56C6C"}},[o._v(o._s(e.error))])],1)})),o.promotionAmountScope.length<5?t("el-button",{staticClass:"ml20",on:{click:function(e){return o.addPromotionAmountScope()}}},[o._v("新增阶梯")]):o._e()],2):o._e()]),t("el-form-item",{attrs:{label:"生效时间",prop:"effectTime"}},[t("el-date-picker",{attrs:{"picker-options":o.pickerOptions,type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":["00:00:00","23:59:59"]},on:{input:o.testClick},model:{value:o.couponForm.effectTime,callback:function(e){o.$set(o.couponForm,"effectTime",e)},expression:"couponForm.effectTime"}})],1),t("h3",[o._v("限制条件")]),t("el-divider"),t("el-form-item",{attrs:{label:"限购"}},[t("el-radio",{attrs:{label:1},model:{value:o.couponForm.useType,callback:function(e){o.$set(o.couponForm,"useType",e)},expression:"couponForm.useType"}},[o._v("免费")]),t("el-radio",{attrs:{label:2},model:{value:o.couponForm.useType,callback:function(e){o.$set(o.couponForm,"useType",e)},expression:"couponForm.useType"}},[o._v("付费")])],1),2==o.couponForm.useType?t("el-form-item",{attrs:{label:"价格"}},[t("el-input-number",{staticStyle:{width:"200px"},attrs:{min:.01,max:99999999,precision:2},model:{value:o.couponForm.price,callback:function(e){o.$set(o.couponForm,"price",e)},expression:"couponForm.price"}}),o._v(" 元 ")],1):o._e(),t("el-form-item",{attrs:{label:"限领"}},[t("el-checkbox",{attrs:{size:"large"},model:{value:o.isPersonLimit,callback:function(e){o.isPersonLimit=e},expression:"isPersonLimit"}},[o._v("限制每人可领张数")]),o.isPersonLimit?t("el-input-number",{staticStyle:{width:"100px","margin-left":"10px"},attrs:{min:0,max:99999999,precision:0},model:{value:o.couponForm.personLimit,callback:function(e){o.$set(o.couponForm,"personLimit",e)},expression:"couponForm.personLimit"}}):o._e()],1),t("el-form-item",{attrs:{label:"限用"}},[t("el-checkbox",{attrs:{size:"large"},model:{value:o.isOrderLimit,callback:function(e){o.isOrderLimit=e},expression:"isOrderLimit"}},[o._v("限制每个订单可以使用张数")]),o.isOrderLimit?t("el-input-number",{staticStyle:{width:"100px","margin-left":"10px"},attrs:{min:0,max:99999999,precision:0},model:{value:o.couponForm.orderLimit,callback:function(e){o.$set(o.couponForm,"orderLimit",e)},expression:"couponForm.orderLimit"}}):o._e()],1),t("h3",[o._v("适用范围")]),t("el-divider"),t("el-form-item",{attrs:{label:"使用范围"}},[t("el-radio-group",{model:{value:o.couponForm.couponScope,callback:function(e){o.$set(o.couponForm,"couponScope",e)},expression:"couponForm.couponScope"}},[t("el-radio-button",{attrs:{label:"1"}},[o._v("全店铺")]),t("el-radio-button",{attrs:{label:"2"}},[o._v("按商品类目")])],1),t("promotion-scope",{attrs:{data:o.goodsCategoryList,defaultCheckeds:o.goodsCategoryCheckeds,visible:o.goodsCategoryVisible},on:{close:o.scopeClose}}),t("div",{directives:[{name:"show",rawName:"v-show",value:2==o.couponForm.couponScope,expression:"couponForm.couponScope==2"}],staticClass:"mt10 mb10"},[t("el-button",{on:{click:o.couponScopeChange}},[o._v("选择商品类目")])],1),t("ul",{directives:[{name:"show",rawName:"v-show",value:o.goodsCategoryCheckedList,expression:"goodsCategoryCheckedList"}]},o._l(o.goodsCategoryCheckedList,(function(e){return t("el-tag",{key:e.goodsCategoryId,staticClass:"mr5",attrs:{closable:""},on:{close:function(t){return o.goodsCategoryCheckedClose(e)}}},[o._v(o._s(e.goodsCategoryName))])})),1),t("div",{directives:[{name:"show",rawName:"v-show",value:o.goodsCategoryErrorFlag,expression:"goodsCategoryErrorFlag"}],staticClass:"el-form-item__error"},[o._v("请选择商品类目")])],1),t("el-form-item",{attrs:{label:"渠道"}},o._l(o.channelList,(function(e,n){return t("div",{key:e.id,staticClass:"mb10"},[t("el-checkbox",{model:{value:o.channelList[n].checked,callback:function(e){o.$set(o.channelList[n],"checked",e)},expression:"channelList[index].checked"}},[o._v(o._s(e.label))]),t("el-input-number",{directives:[{name:"show",rawName:"v-show",value:o.channelList[n].checked,expression:"channelList[index].checked"}],staticClass:"ml10",attrs:{min:1,max:99999999,precision:0},model:{value:o.channelList[n].inventory,callback:function(e){o.$set(o.channelList[n],"inventory",e)},expression:"channelList[index].inventory"}}),t("div",{directives:[{name:"show",rawName:"v-show",value:o.channelErrorFlag,expression:"channelErrorFlag"}],staticClass:"el-form-item__error"},[o._v("渠道数据错误")])],1)})),0),t("el-form-item",[t("el-button",{attrs:{type:"primary",loading:o.loading},on:{click:function(e){return o.onSubmit("couponForm")}}},[o._v(o._s(o.buttonText))]),t("el-button",{on:{click:function(e){return o.$router.push({name:"couponList"})}}},[o._v("取消")])],1)],1)],1)],1)},r=[],i=(t("fe59"),t("ecb4"),t("ea69"),t("e18c"),t("08ba"),t("c276")),c=t("09bb"),a=t("e395"),s={components:{PromotionScope:a["a"]},data:function(){return{pickerOptions:{shortcuts:[{text:"有效期一周",onClick:function(o){var e=new Date,t=new Date;e.setTime(t.getTime()+6048e5),o.$emit("pick",[t,e])}},{text:"有效期一个月",onClick:function(o){var e=new Date,t=new Date;e.setTime(t.getTime()+2592e6),o.$emit("pick",[t,e])}},{text:"有效期三个月",onClick:function(o){var e=new Date,t=new Date;e.setTime(t.getTime()+7776e6),o.$emit("pick",[t,e])}},{text:"有效期半年",onClick:function(o){var e=new Date,t=new Date;e.setTime(t.getTime()+15552e6),o.$emit("pick",[t,e])}},{text:"有效期一年",onClick:function(o){var e=new Date,t=new Date;e.setTime(t.getTime()+31536e6),o.$emit("pick",[t,e])}}]},channelList:[],channelErrorFlag:!1,goodsCategoryErrorFlag:!1,goodsCategoryVisible:!1,goodsCategoryList:[],goodsCategoryCheckeds:[],goodsCategoryCheckedList:[],rules:{couponName:[{required:!0,message:"请输入优惠券名称",trigger:"blur"}],effectTime:[{type:"array",required:!0,message:"请选择生效时间",trigger:"change"}],description:[{required:!0,message:"请输入商品详情",trigger:"blur"}]},couponTypeOptions:[],isPersonLimit:!1,isOrderLimit:!1,promotionAmountScope:[{orderFullAmount:"",promotionAmount:""},{orderFullAmount:"",promotionAmount:""}],couponForm:{id:"",couponName:"",couponType:1,promotionAmount:"",orderFullAmount:"",discountAmount:"",promotionMaxAmount:"",effectTime:"",useType:1,personLimit:0,orderLimit:0,price:0,couponScope:1,promotionScopeList:[],channelList:[]},couponTypeErrorFlag:!1,couponTypeErrorText:"",loading:!1,buttonText:"立即创建"}},created:function(){var o=this;c["a"].getPromotionTypes(1).then((function(e){o.couponTypeOptions=e.data,c["a"].getCouponChannelTypes().then((function(e){o.channelList=e.data;var t=o.$route.query.id;t&&(o.buttonText="立即保存",c["a"].couponGet(t).then((function(e){o.couponForm=e.data,o.promotionAmountScope=e.data.promotionAmountScopeList,e.data.personLimit>0&&(o.isPersonLimit=!0),e.data.orderLimit>0&&(o.isOrderLimit=!0),o.$set(o.couponForm,"effectTime",[new Date(e.data.startTime),new Date(e.data.endTime)]),o.goodsCategoryCheckedList=e.data.promotionScopeList,e.data.channelList.forEach((function(e){o.channelList.forEach((function(o){o.value==e.channelId&&(o.checked=!0,o.inventory=e.inventory)}))}))})))}))}))},methods:{couponScopeChange:function(){if(this.goodsCategoryList&&0!=this.goodsCategoryList.length?this.goodsCategoryVisible=!0:this.getCategoryData(),this.goodsCategoryCheckedList){var o=[];this.goodsCategoryCheckedList.forEach((function(e){o.push(e.goodsCategoryId)})),this.goodsCategoryCheckeds=o}console.log(this.goodsCategoryCheckeds)},goodsCategoryCheckedClose:function(o){this.goodsCategoryCheckedList.splice(this.goodsCategoryCheckedList.indexOf(o),1)},scopeClose:function(o){this.goodsCategoryVisible=!1,this.goodsCategoryCheckedList=o},getCategoryData:function(){var o=this;c["a"].goodsCategoryGetTree(2).then((function(e){o.goodsCategoryList=e.data,o.goodsCategoryVisible=!0}))},testClick:function(o){var e=this;this.$nextTick((function(){e.couponForm.effectTime=[],e.$set(e.couponForm,"effectTime",[o[0],o[1]])}))},addPromotionAmountScope:function(){this.promotionAmountScope.push({orderFullAmount:"",promotionAmount:""})},delPromotionAmountScope:function(o){this.promotionAmountScope.splice(o,1)},onSubmit:function(o){var e=this;this.$refs[o].validate((function(o){if(!o)return!1;if(2==e.couponForm.couponType||3==e.couponForm.couponType){if(e.couponForm.orderFullAmount<=e.couponForm.promotionAmount)return e.couponTypeErrorFlag=!0,void(e.couponTypeErrorText="订单金额必须大于优惠金额");e.couponTypeErrorFlag=!1}else if(5==e.couponForm.couponType){for(var t,n,r=0;r<e.promotionAmountScope.length;r++){if(e.promotionAmountScope[r].orderFullAmount<=e.promotionAmountScope[r].promotionAmount)return e.couponTypeErrorFlag=!0,void(e.couponTypeErrorText="阶梯有误");if(0==r)t=e.promotionAmountScope[r].orderFullAmount,n=e.promotionAmountScope[r].promotionAmount;else if(t>=e.promotionAmountScope[r].orderFullAmount||n>=e.promotionAmountScope[r].promotionAmount)return e.couponTypeErrorFlag=!0,void(e.couponTypeErrorText="阶梯有误")}e.couponTypeErrorFlag=!1,e.couponForm.promotionScopeList=e.promotionAmountScope}if(2==e.couponForm.couponScope){if(!e.goodsCategoryCheckedList||0==e.goodsCategoryCheckedList.length)return void(e.goodsCategoryErrorFlag=!0);e.couponForm.promotionScopeList=e.goodsCategoryCheckedList}var a=[];e.channelList.forEach((function(o){if(o.checked){if(!o.inventory)return void(e.channelErrorFlag=!0);a.push({channelId:o.value,inventory:o.inventory,isIssueTime:!1})}})),a&&0!=a.length?(e.channelErrorFlag=!1,e.couponForm.channelList=a,e.goodsCategoryErrorFlag=!1,e.couponForm.startTime=i["a"].dateFormatter(e.couponForm.effectTime[0]),e.couponForm.endTime=i["a"].dateFormatter(e.couponForm.effectTime[1]),e.loading=!0,console.log(e.couponForm),c["a"].couponAdd(e.couponForm).then((function(o){console.log(o),e.couponForm.id?i["a"].messageSuccess("保存成功"):i["a"].messageSuccess("创建成功"),e.$router.push({name:"couponList"})})).finally((function(o){e.loading&&(e.loading=!1)}))):e.channelErrorFlag=!0}))}}},l=s,u=t("9ca4"),p=Object(u["a"])(l,n,r,!1,null,null,null);e["default"]=p.exports}}]);
//# sourceMappingURL=chunk-24de4228.ca8e3311.js.map