(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fe8071c2"],{c587:function(o,t,e){"use strict";e.r(t);var r=function(){var o=this,t=o.$createElement,e=o._self._c||t;return e("div",{staticClass:"gooods__edit"},[e("el-card",{attrs:{shadow:"always"}},[e("el-form",{ref:"subPromotionForm",attrs:{model:o.subPromotionForm,"label-width":"120px",rules:o.rules}},[e("h3",[o._v("基本信息")]),e("el-divider"),e("el-form-item",{attrs:{label:"订单促销名称",prop:"subPromotionName"}},[e("el-input",{staticStyle:{width:"400px"},attrs:{placeholder:"订单促销名称",maxlength:"50","show-word-limit":""},model:{value:o.subPromotionForm.subPromotionName,callback:function(t){o.$set(o.subPromotionForm,"subPromotionName",t)},expression:"subPromotionForm.subPromotionName"}})],1),e("el-form-item",{attrs:{label:"订单促销类型"}},[e("el-select",{attrs:{placeholder:"请选择"},model:{value:o.subPromotionForm.subPromotionType,callback:function(t){o.$set(o.subPromotionForm,"subPromotionType",t)},expression:"subPromotionForm.subPromotionType"}},o._l(o.subPromotionTypeOptions,(function(o){return e("el-option",{key:o.value,attrs:{label:o.label,value:o.value}})})),1),o.subPromotionTypeErrorFlag?e("div",{staticClass:"el-form-item__error"},[o._v(o._s(o.subPromotionTypeErrorText))]):o._e()],1),e("el-form-item",[21==o.subPromotionForm.subPromotionType||22==o.subPromotionForm.subPromotionType||23==o.subPromotionForm.subPromotionType?e("span",[22==o.subPromotionForm.subPromotionType?e("span",[o._v("每")]):o._e(),o._v("满 "),e("el-input-number",{staticStyle:{width:"150px"},attrs:{min:.01,max:99999999,precision:2},model:{value:o.subPromotionForm.orderFullAmount,callback:function(t){o.$set(o.subPromotionForm,"orderFullAmount",t)},expression:"subPromotionForm.orderFullAmount"}}),o._v(" 元 ")],1):o._e(),21==o.subPromotionForm.subPromotionType||22==o.subPromotionForm.subPromotionType?e("span",[o._v(" 优惠 "),e("el-input-number",{staticStyle:{width:"150px"},attrs:{min:.01,max:99999999,precision:2},model:{value:o.subPromotionForm.promotionAmount,callback:function(t){o.$set(o.subPromotionForm,"promotionAmount",t)},expression:"subPromotionForm.promotionAmount"}}),o._v(" 元 ")],1):o._e(),23==o.subPromotionForm.subPromotionType?e("span",[o._v(" 优惠 "),e("el-input-number",{staticStyle:{width:"150px"},attrs:{min:.1,max:9.9,precision:1},model:{value:o.subPromotionForm.discountAmount,callback:function(t){o.$set(o.subPromotionForm,"discountAmount",t)},expression:"subPromotionForm.discountAmount"}}),o._v(" 折 ")],1):o._e(),22==o.subPromotionForm.subPromotionType||23==o.subPromotionForm.subPromotionType?e("span",[o._v(" 封顶优惠 "),e("el-input-number",{staticStyle:{width:"150px"},attrs:{max:99999999,precision:2},model:{value:o.subPromotionForm.promotionMaxAmount,callback:function(t){o.$set(o.subPromotionForm,"promotionMaxAmount",t)},expression:"subPromotionForm.promotionMaxAmount"}}),o._v(" 元 ")],1):o._e(),24==o.subPromotionForm.subPromotionType?e("div",[o._l(o.promotionAmountScope,(function(t,r){return e("div",{key:r,staticClass:"mb10"},[o._v(" 满 "),e("el-input-number",{staticStyle:{width:"150px"},attrs:{min:.01,max:99999999,precision:2},model:{value:t.orderFullAmount,callback:function(e){o.$set(t,"orderFullAmount",e)},expression:"item.orderFullAmount"}}),o._v(" 元 优惠 "),e("el-input-number",{staticStyle:{width:"150px"},attrs:{min:.01,max:99999999,precision:2},model:{value:t.promotionAmount,callback:function(e){o.$set(t,"promotionAmount",e)},expression:"item.promotionAmount"}}),o._v(" 元 "),o.promotionAmountScope.length>2?e("el-button",{staticClass:"ml20",attrs:{type:"danger"},on:{click:function(t){return o.delPromotionAmountScope(r)}}},[o._v("删除阶梯")]):o._e(),e("span",{staticClass:"ml10",staticStyle:{color:"#F56C6C"}},[o._v(o._s(t.error))])],1)})),o.promotionAmountScope.length<5?e("el-button",{staticClass:"ml20",on:{click:function(t){return o.addPromotionAmountScope()}}},[o._v("新增阶梯")]):o._e()],2):o._e()]),e("el-form-item",{attrs:{label:"生效时间",prop:"effectTime"}},[e("el-date-picker",{attrs:{"picker-options":o.pickerOptions,type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","default-time":["00:00:00","23:59:59"]},on:{input:o.testClick},model:{value:o.subPromotionForm.effectTime,callback:function(t){o.$set(o.subPromotionForm,"effectTime",t)},expression:"subPromotionForm.effectTime"}})],1),e("h3",[o._v("适用范围")]),e("el-divider"),e("el-form-item",{attrs:{label:"使用范围"}},[e("el-radio-group",{model:{value:o.subPromotionForm.subPromotionScope,callback:function(t){o.$set(o.subPromotionForm,"subPromotionScope",t)},expression:"subPromotionForm.subPromotionScope"}},[e("el-radio-button",{attrs:{label:"1"}},[o._v("全店铺")]),e("el-radio-button",{attrs:{label:"2"}},[o._v("按商品类目")])],1),e("promotion-scope",{attrs:{data:o.goodsCategoryList,defaultCheckeds:o.goodsCategoryCheckeds,visible:o.goodsCategoryVisible},on:{close:o.scopeClose}}),e("div",{directives:[{name:"show",rawName:"v-show",value:2==o.subPromotionForm.subPromotionScope,expression:"subPromotionForm.subPromotionScope==2"}],staticClass:"mt10 mb10"},[e("el-button",{on:{click:o.subPromotionScopeChange}},[o._v("选择商品类目")])],1),e("ul",{directives:[{name:"show",rawName:"v-show",value:o.goodsCategoryCheckedList,expression:"goodsCategoryCheckedList"}]},o._l(o.goodsCategoryCheckedList,(function(t){return e("el-tag",{key:t.goodsCategoryId,staticClass:"mr5",attrs:{closable:""},on:{close:function(e){return o.goodsCategoryCheckedClose(t)}}},[o._v(o._s(t.goodsCategoryName))])})),1),e("div",{directives:[{name:"show",rawName:"v-show",value:o.goodsCategoryErrorFlag,expression:"goodsCategoryErrorFlag"}],staticClass:"el-form-item__error"},[o._v("请选择商品类目")])],1),e("el-form-item",[e("el-button",{attrs:{type:"primary",loading:o.loading},on:{click:function(t){return o.onSubmit("subPromotionForm")}}},[o._v(o._s(o.buttonText))]),e("el-button",{on:{click:function(t){return o.$router.push({name:"subPromotionList"})}}},[o._v("取消")])],1)],1)],1)],1)},i=[],n=(e("fe59"),e("ecb4"),e("ea69"),e("e18c"),e("08ba"),e("c276")),s=e("09bb"),m=e("e395"),a={components:{PromotionScope:m["a"]},data:function(){return{pickerOptions:{shortcuts:[{text:"有效期一周",onClick:function(o){var t=new Date,e=new Date;t.setTime(e.getTime()+6048e5),o.$emit("pick",[e,t])}},{text:"有效期一个月",onClick:function(o){var t=new Date,e=new Date;t.setTime(e.getTime()+2592e6),o.$emit("pick",[e,t])}},{text:"有效期三个月",onClick:function(o){var t=new Date,e=new Date;t.setTime(e.getTime()+7776e6),o.$emit("pick",[e,t])}},{text:"有效期半年",onClick:function(o){var t=new Date,e=new Date;t.setTime(e.getTime()+15552e6),o.$emit("pick",[e,t])}},{text:"有效期一年",onClick:function(o){var t=new Date,e=new Date;t.setTime(e.getTime()+31536e6),o.$emit("pick",[e,t])}}]},goodsCategoryErrorFlag:!1,goodsCategoryVisible:!1,goodsCategoryList:[],goodsCategoryCheckeds:[],goodsCategoryCheckedList:[],rules:{subPromotionName:[{required:!0,message:"请输入订单促销名称",trigger:"blur"}],effectTime:[{type:"array",required:!0,message:"请选择生效时间",trigger:"change"}],description:[{required:!0,message:"请输入商品详情",trigger:"blur"}]},subPromotionTypeOptions:[],promotionAmountScope:[{orderFullAmount:"",promotionAmount:""},{orderFullAmount:"",promotionAmount:""}],subPromotionForm:{id:"",subPromotionName:"",subPromotionType:21,promotionAmount:"",orderFullAmount:"",discountAmount:"",promotionMaxAmount:"",effectTime:"",subPromotionScope:1,promotionScopeList:[]},subPromotionTypeErrorFlag:!1,subPromotionTypeErrorText:"",loading:!1,buttonText:"立即创建"}},created:function(){var o=this;this.getSubPromotionTypeList();var t=this.$route.query.id;t&&(this.buttonText="立即保存",s["a"].subPromotionGet(t).then((function(t){o.subPromotionForm=t.data,o.promotionAmountScope=t.data.promotionAmountScopeList,o.$set(o.subPromotionForm,"effectTime",[new Date(t.data.startTime),new Date(t.data.endTime)]),o.goodsCategoryCheckedList=t.data.promotionScopeList})))},methods:{subPromotionScopeChange:function(){if(this.goodsCategoryList&&0!=this.goodsCategoryList.length?this.goodsCategoryVisible=!0:this.getCategoryData(),this.goodsCategoryCheckedList){var o=[];this.goodsCategoryCheckedList.forEach((function(t){o.push(t.goodsCategoryId)})),this.goodsCategoryCheckeds=o}console.log(this.goodsCategoryCheckeds)},goodsCategoryCheckedClose:function(o){this.goodsCategoryCheckedList.splice(this.goodsCategoryCheckedList.indexOf(o),1),console.log(this.goodsCategoryCheckedList)},scopeClose:function(o){this.goodsCategoryVisible=!1,this.goodsCategoryCheckedList=o},getCategoryData:function(){var o=this;s["a"].goodsCategoryGetTree(2).then((function(t){o.goodsCategoryList=t.data,o.goodsCategoryVisible=!0}))},testClick:function(o){var t=this;this.$nextTick((function(){t.subPromotionForm.effectTime=[],t.$set(t.subPromotionForm,"effectTime",[o[0],o[1]])}))},getSubPromotionTypeList:function(){var o=this;s["a"].getPromotionTypes(2).then((function(t){o.subPromotionTypeOptions=t.data}))},addPromotionAmountScope:function(){this.promotionAmountScope.push({orderFullAmount:"",promotionAmount:""})},delPromotionAmountScope:function(o){this.promotionAmountScope.splice(o,1)},onSubmit:function(o){var t=this;this.$refs[o].validate((function(o){if(!o)return!1;if(21==t.subPromotionForm.subPromotionType||22==t.subPromotionForm.subPromotionType){if(t.subPromotionForm.orderFullAmount<=t.subPromotionForm.promotionAmount)return t.subPromotionTypeErrorFlag=!0,void(t.subPromotionTypeErrorText="订单金额必须大于优惠金额");t.subPromotionTypeErrorFlag=!1}else if(24==t.subPromotionForm.subPromotionType){for(var e,r,i=0;i<t.promotionAmountScope.length;i++){if(t.promotionAmountScope[i].orderFullAmount<=t.promotionAmountScope[i].promotionAmount)return t.subPromotionTypeErrorFlag=!0,void(t.subPromotionTypeErrorText="阶梯有误");if(0==i)e=t.promotionAmountScope[i].orderFullAmount,r=t.promotionAmountScope[i].promotionAmount;else if(e>=t.promotionAmountScope[i].orderFullAmount||r>=t.promotionAmountScope[i].promotionAmount)return t.subPromotionTypeErrorFlag=!0,void(t.subPromotionTypeErrorText="阶梯有误")}t.subPromotionTypeErrorFlag=!1,t.subPromotionForm.promotionScopeList=t.promotionAmountScope}else 23==t.subPromotionForm.subPromotionType&&(t.subPromotionForm.promotionAmount=null);if(2==t.subPromotionForm.subPromotionScope){if(!t.goodsCategoryCheckedList||0==t.goodsCategoryCheckedList.length)return void(t.goodsCategoryErrorFlag=!0);t.subPromotionForm.promotionScopeList=t.goodsCategoryCheckedList}t.goodsCategoryErrorFlag=!1,t.subPromotionForm.startTime=n["a"].dateFormatter(t.subPromotionForm.effectTime[0]),t.subPromotionForm.endTime=n["a"].dateFormatter(t.subPromotionForm.effectTime[1]),t.loading=!0,console.log(t.subPromotionForm),s["a"].subPromotionAdd(t.subPromotionForm).then((function(o){console.log(o),t.subPromotionForm.id?n["a"].messageSuccess("保存成功"):n["a"].messageSuccess("创建成功"),t.$router.push({name:"subPromotionList"})})).finally((function(o){t.loading&&(t.loading=!1)}))}))}}},u=a,l=e("9ca4"),c=Object(l["a"])(u,r,i,!1,null,null,null);t["default"]=c.exports},e395:function(o,t,e){"use strict";var r=function(){var o=this,t=o.$createElement,e=o._self._c||t;return e("el-dialog",{attrs:{title:"请选择商品类目","show-close":!1,visible:o.visible,"close-on-click-modal":!1,width:"30%"},on:{"update:visible":function(t){o.visible=t}}},[e("el-tree",{ref:"tree",attrs:{data:o.data,"show-checkbox":"","node-key":"id","default-checked-keys":o.defaultCheckeds,"highlight-current":"",props:o.goodsCategoryProps}}),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:o.close}},[o._v("确 定")])],1)],1)},i=[],n=(e("fe59"),e("08ba"),e("c276"),e("09bb"),{props:{data:{type:Array,default:function(){return[]}},defaultCheckeds:{type:Array,default:function(){return[]}},visible:{type:Boolean,default:function(){return!1}}},data:function(){return{goodsCategoryProps:{children:"childCategoryList",label:"categoryName"}}},methods:{close:function(){var o=this.$refs.tree.getCheckedNodes(),t=[];o&&o.length>0?(o.forEach((function(o){o.childCategoryList||t.push({goodsCategoryId:o.id,goodsCategoryName:o.categoryName})})),this.$emit("close",t)):this.$alert("请选择商品类目","提示")}}}),s=n,m=e("9ca4"),a=Object(m["a"])(s,r,i,!1,null,null,null);t["a"]=a.exports},ea69:function(o,t,e){"use strict";var r=e("1c8b"),i=e("e1d6"),n=e("3da3"),s=e("d88d"),m=e("3553"),a=e("1ca1"),u=e("1bbd"),l=e("1ea7"),c=e("ff9c"),d=l("splice"),p=c("splice",{ACCESSORS:!0,0:0,1:2}),b=Math.max,g=Math.min,f=9007199254740991,h="Maximum allowed length exceeded";r({target:"Array",proto:!0,forced:!d||!p},{splice:function(o,t){var e,r,l,c,d,p,P=m(this),y=s(P.length),C=i(o,y),F=arguments.length;if(0===F?e=r=0:1===F?(e=0,r=y-C):(e=F-2,r=g(b(n(t),0),y-C)),y+e-r>f)throw TypeError(h);for(l=a(P,r),c=0;c<r;c++)d=C+c,d in P&&u(l,c,P[d]);if(l.length=r,e<r){for(c=C;c<y-r;c++)d=c+r,p=c+e,d in P?P[p]=P[d]:delete P[p];for(c=y;c>y-r+e;c--)delete P[c-1]}else if(e>r)for(c=y-r;c>C;c--)d=c+r-1,p=c+e-1,d in P?P[p]=P[d]:delete P[p];for(c=0;c<e;c++)P[c+C]=arguments[c+2];return P.length=y-r+e,l}})},ecb4:function(o,t,e){"use strict";var r=e("1c8b"),i=e("45af").indexOf,n=e("d7e1"),s=e("ff9c"),m=[].indexOf,a=!!m&&1/[1].indexOf(1,-0)<0,u=n("indexOf"),l=s("indexOf",{ACCESSORS:!0,1:0});r({target:"Array",proto:!0,forced:a||!u||!l},{indexOf:function(o){return a?m.apply(this,arguments)||0:i(this,o,arguments.length>1?arguments[1]:void 0)}})}}]);
//# sourceMappingURL=chunk-fe8071c2.15c8bbe2.js.map